using UnityEngine;
using System.Collections;

public class MeleeAttack : MonoBehaviour
{

    float swingTime = 1.0f;
    float currentSwingTime = 0.0f;
    public int damage = 1;
	// Use this for initialization
	void Start ()
    {
	
	}
	
	// Update is called once per frame
	void Update ()
    {
        //transform.up = 
	}

    void OnEnabled()
    {
        currentSwingTime = 0.0f;
    }

    private float knockbackDistance = 2.0f;
    void OnTriggerStay2D(Collider2D other)
    {
        
        if (Player.Instance.attackState == Player.AttackState.kMeleeAttack && Player.Instance.canMeleeAttack)
        {
            Debug.Log("Melee attack");
            if (other.GetComponent<Enemy>() != null)
            {
                other.transform.position += Player.Instance.GetComponentInChildren<MeleeAttack>().transform.up * knockbackDistance;
                other.GetComponent<Enemy>().CurHitPoints -= damage;
                Global.Instance.SpawnPoint(damage, other.gameObject.transform.position);
                StartCoroutine(other.GetComponent<Enemy>().FlashMe(0.5f, 0.1f));
                other.GetComponent<Enemy>().SetToStun();
            }

            // Valid enemy to melee
            //if (other.GetComponent<CorruptedFile>() != null)
            //{
            //    other.transform.position += Player.Instance.GetComponentInChildren<MeleeAttack>().transform.up * knockbackDistance;
            //    other.GetComponent<CorruptedFile>().CurHitPoints -= damage;
            //    StartCoroutine(other.GetComponent<Enemy>().FlashMe(0.2f, 0.1f));
            //}
            //// Valid enemy to melee
            //if (other.GetComponent<Spyware>() != null)
            //{
            //    other.transform.position += Player.Instance.GetComponentInChildren<MeleeAttack>().transform.up * knockbackDistance;
            //    other.GetComponent<Spyware>().CurHitPoints -= damage;
            //    StartCoroutine(other.GetComponent<Enemy>().FlashMe(0.2f, 0.1f));
            //}

            //if (other.GetComponent<Worm>() != null)
            //{
            //    other.transform.position += Player.Instance.GetComponentInChildren<MeleeAttack>().transform.up * knockbackDistance;
            //    other.GetComponent<Worm>().CurHitPoints -= damage;
            //    StartCoroutine(other.GetComponent<Enemy>().FlashMe(0.2f, 0.1f));
            //}

            //if (other.GetComponent<Trojan>() != null)
            //{
            //    other.transform.position += Player.Instance.GetComponentInChildren<MeleeAttack>().transform.up * knockbackDistance;
            //    other.GetComponent<Trojan>().CurHitPoints -= damage;
            //    StartCoroutine(other.GetComponent<Enemy>().FlashMe(0.2f, 0.1f));
            //}
        }
    }
}
